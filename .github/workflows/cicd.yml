name: cicd-workflow with slack integration
on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    env:
      SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
    steps:
    - uses: actions/checkout@v3

    # Set up Node (choose LTS that matches your project; Next 14 -> Node 18+)
    - name: Set up Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm' # speeds up npm installs

    - name: Install dependencies
      run: npm ci

    - name: Build
      run: npm run build
      env:
        CI: true

    - name: Run Lint
      if: always()
      run: npm run lint

    # Optional: run tests if you add them
    #- name: Run tests
    #  run: npm test

    - uses: act10ns/slack@v2
      if: always()
      with:
        channel: '#hushh-main-website-github-workflow'
        status: ${{ job.status }}
        steps: ${{ toJson(steps) }}
